<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#008080">
    <title>PersonalOS</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#008080',
                    }
                }
            }
        }
    </script>
    <style>
        @media (display-mode: standalone) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
    </style>
</head>
<body class="bg-black text-white min-h-screen p-4">
    
    <!-- Landing Section -->
    <div class="max-w-6xl mx-auto mb-8">
        <div class="bg-gradient-to-r from-primary/20 to-primary/5 border border-primary/30 rounded-lg p-8 md:p-12 text-center">
            <h1 class="text-3xl md:text-5xl font-bold text-primary mb-4">PersonalOS</h1>
            <p class="text-2xl md:text-3xl font-semibold tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-primary via-white to-primary mb-6">
                PERSEVERANCE AND FAITH
            </p>
            
            <!-- Work/Personal Toggle -->
            <div class="flex items-center justify-center gap-3">
                <span class="text-sm font-medium" id="personalLabel">Personal</span>
                <button onclick="app.toggleCategory()" class="relative w-14 h-7 bg-[#2a2a2a] rounded-full transition-colors duration-200" id="categoryToggle">
                    <div class="absolute top-1 left-1 w-5 h-5 bg-white rounded-full transition-transform duration-200" id="categoryToggleKnob"></div>
                </button>
                <span class="text-sm font-medium" id="workLabel">Work</span>
            </div>
        </div>
    </div>
    
    <!-- Grid Container -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-6xl mx-auto">
        
        <!-- Time Widget -->
        <div class="bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg p-6 flex flex-col items-center justify-center min-h-[200px]">
            <div id="time" class="text-6xl font-bold text-primary mb-2">12:34</div>
            <div id="date" class="text-gray-400">Friday, December 27</div>
        </div>
        
        <!-- Mood Tracker Widget -->
        <div class="bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg p-6 min-h-[200px] md:col-span-2">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">Mood Tracker</h2>
                <button onclick="app.saveMood()" class="text-primary hover:text-primary/80 text-sm" id="saveMoodBtn">Save</button>
            </div>
            
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Input Section -->
                <div class="space-y-4">
                    <!-- Physical Level -->
                    <div>
                        <label class="text-sm text-gray-400 mb-2 block">Physical: <span id="physicalValue" class="text-primary">3</span></label>
                        <input type="range" min="1" max="5" value="3" id="physicalSlider" 
                               oninput="document.getElementById('physicalValue').textContent = this.value"
                               class="w-full h-2 bg-[#2a2a2a] rounded-lg appearance-none cursor-pointer accent-primary">
                    </div>
                    
                    <!-- Mental Level -->
                    <div>
                        <label class="text-sm text-gray-400 mb-2 block">Mental: <span id="mentalValue" class="text-primary">3</span></label>
                        <input type="range" min="1" max="5" value="3" id="mentalSlider" 
                               oninput="document.getElementById('mentalValue').textContent = this.value"
                               class="w-full h-2 bg-[#2a2a2a] rounded-lg appearance-none cursor-pointer accent-primary">
                    </div>
                    
                    <!-- Mood Emoji -->
                    <div>
                        <label class="text-sm text-gray-400 mb-2 block">Mood</label>
                        <div class="flex gap-2 justify-between">
                            <button onclick="app.selectMood('üò¢')" class="mood-btn text-3xl p-2 rounded hover:bg-[#2a2a2a] transition-colors" data-mood="üò¢">üò¢</button>
                            <button onclick="app.selectMood('üòï')" class="mood-btn text-3xl p-2 rounded hover:bg-[#2a2a2a] transition-colors" data-mood="üòï">üòï</button>
                            <button onclick="app.selectMood('üòê')" class="mood-btn text-3xl p-2 rounded hover:bg-[#2a2a2a] transition-colors" data-mood="üòê">üòê</button>
                            <button onclick="app.selectMood('üôÇ')" class="mood-btn text-3xl p-2 rounded hover:bg-[#2a2a2a] transition-colors" data-mood="üôÇ">üôÇ</button>
                            <button onclick="app.selectMood('üòÑ')" class="mood-btn text-3xl p-2 rounded hover:bg-[#2a2a2a] transition-colors" data-mood="üòÑ">üòÑ</button>
                        </div>
                    </div>
                </div>
                
                <!-- Analytics Section -->
                <div>
                    <h3 class="text-sm font-medium text-gray-400 mb-3">Recent History</h3>
                    <div id="moodHistory" class="space-y-2 max-h-[180px] overflow-y-auto">
                        <!-- Mood history will be rendered here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tasks Widget -->
        <div class="bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg p-6 min-h-[200px]">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">Tasks</h2>
                <button onclick="app.addTask()" class="text-primary hover:text-primary/80 text-2xl">+</button>
            </div>
            <div id="tasks" class="space-y-3">
                <!-- Tasks will be rendered here -->
            </div>
        </div>
        
        <!-- Notes Widget -->
        <div class="bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg p-6 min-h-[200px]">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">Notes</h2>
                <button onclick="app.addNote()" class="text-primary hover:text-primary/80 text-2xl">+</button>
            </div>
            <div id="notes" class="space-y-3">
                <!-- Notes will be rendered here -->
            </div>
        </div>
        
    </div>

    <!-- Modal for adding/editing -->
    <div id="modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
        <div class="bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg p-6 max-w-md w-full">
            <h3 id="modalTitle" class="text-xl font-semibold mb-4">Add Item</h3>
            <div id="modalContent"></div>
            <div class="flex gap-3 mt-4">
                <button onclick="app.closeModal()" class="flex-1 bg-[#2a2a2a] hover:bg-[#3a3a3a] rounded px-4 py-2">Cancel</button>
                <button id="modalSubmit" class="flex-1 bg-primary hover:bg-primary/80 rounded px-4 py-2">Save</button>
            </div>
        </div>
    </div>
    
    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'personalos-v1';
                    self.addEventListener('install', (e) => {
                        e.waitUntil(caches.open(CACHE_NAME).then(cache => cache.addAll(['/'])));
                    });
                    self.addEventListener('fetch', (e) => {
                        e.respondWith(
                            caches.match(e.request).then(response => response || fetch(e.request))
                        );
                    });
                `;
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                navigator.serviceWorker.register(swUrl);
            });
        }

        // IndexedDB Manager
        class DB {
            constructor() {
                this.db = null;
                this.dbName = 'PersonalOS';
                this.version = 2; // Incremented for moods store
            }

            async init() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.dbName, this.version);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        this.db = request.result;
                        resolve(this.db);
                    };
                    
                    request.onupgradeneeded = (e) => {
                        const db = e.target.result;
                        
                        if (!db.objectStoreNames.contains('tasks')) {
                            db.createObjectStore('tasks', { keyPath: 'id', autoIncrement: true });
                        }
                        if (!db.objectStoreNames.contains('notes')) {
                            db.createObjectStore('notes', { keyPath: 'id', autoIncrement: true });
                        }
                        if (!db.objectStoreNames.contains('events')) {
                            db.createObjectStore('events', { keyPath: 'id', autoIncrement: true });
                        }
                        if (!db.objectStoreNames.contains('moods')) {
                            db.createObjectStore('moods', { keyPath: 'id', autoIncrement: true });
                        }
                    };
                });
            }

            async getAll(storeName) {
                const tx = this.db.transaction(storeName, 'readonly');
                const store = tx.objectStore(storeName);
                return new Promise((resolve, reject) => {
                    const request = store.getAll();
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            async add(storeName, data) {
                const tx = this.db.transaction(storeName, 'readwrite');
                const store = tx.objectStore(storeName);
                return new Promise((resolve, reject) => {
                    const request = store.add(data);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            async update(storeName, data) {
                const tx = this.db.transaction(storeName, 'readwrite');
                const store = tx.objectStore(storeName);
                return new Promise((resolve, reject) => {
                    const request = store.put(data);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            async delete(storeName, id) {
                const tx = this.db.transaction(storeName, 'readwrite');
                const store = tx.objectStore(storeName);
                return new Promise((resolve, reject) => {
                    const request = store.delete(id);
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            }
        }

        // Main App
        class App {
            constructor() {
                this.db = new DB();
                this.currentDate = new Date();
                this.currentCategory = 'personal'; // 'personal' or 'work'
                this.selectedMood = null;
                this.init();
            }

            async init() {
                await this.db.init();
                this.updateTime();
                await this.renderTasks();
                await this.renderNotes();
                await this.renderMoodHistory();
                
                // Initialize toggle UI
                document.getElementById('personalLabel').classList.add('text-primary');
                
                setInterval(() => this.updateTime(), 1000);
            }

            updateTime() {
                const now = new Date();
                const timeEl = document.getElementById('time');
                const dateEl = document.getElementById('date');
                
                timeEl.textContent = now.toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: false 
                });
                
                dateEl.textContent = now.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    month: 'long', 
                    day: 'numeric' 
                });
            }

            toggleCategory() {
                this.currentCategory = this.currentCategory === 'personal' ? 'work' : 'personal';
                
                // Update toggle UI
                const toggle = document.getElementById('categoryToggle');
                const knob = document.getElementById('categoryToggleKnob');
                const personalLabel = document.getElementById('personalLabel');
                const workLabel = document.getElementById('workLabel');
                
                if (this.currentCategory === 'work') {
                    toggle.classList.add('bg-primary');
                    knob.style.transform = 'translateX(28px)';
                    personalLabel.classList.remove('text-primary');
                    workLabel.classList.add('text-primary');
                } else {
                    toggle.classList.remove('bg-primary');
                    knob.style.transform = 'translateX(0)';
                    personalLabel.classList.add('text-primary');
                    workLabel.classList.remove('text-primary');
                }
                
                // Re-render everything
                this.renderTasks();
                this.renderNotes();
            }

            selectMood(emoji) {
                this.selectedMood = emoji;
                // Update UI to show selection
                document.querySelectorAll('.mood-btn').forEach(btn => {
                    if (btn.dataset.mood === emoji) {
                        btn.style.backgroundColor = '#008080';
                        btn.style.transform = 'scale(1.1)';
                    } else {
                        btn.style.backgroundColor = '';
                        btn.style.transform = '';
                    }
                });
            }

            async saveMood() {
                const physical = document.getElementById('physicalSlider').value;
                const mental = document.getElementById('mentalSlider').value;
                const mood = this.selectedMood;
                
                if (!mood) {
                    return;
                }
                
                const today = new Date().toISOString().split('T')[0];
                
                await this.db.add('moods', {
                    date: today,
                    physical: parseInt(physical),
                    mental: parseInt(mental),
                    mood: mood,
                    timestamp: new Date().toISOString()
                });
                
                // Reset form
                document.getElementById('physicalSlider').value = 3;
                document.getElementById('mentalSlider').value = 3;
                document.getElementById('physicalValue').textContent = 3;
                document.getElementById('mentalValue').textContent = 3;
                this.selectedMood = null;
                document.querySelectorAll('.mood-btn').forEach(btn => {
                    btn.style.backgroundColor = '';
                    btn.style.transform = '';
                });
                
                // Refresh history
                await this.renderMoodHistory();
            }

            async renderMoodHistory() {
                const allMoods = await this.db.getAll('moods');
                const moods = allMoods
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                    .slice(0, 7);
                
                const container = document.getElementById('moodHistory');
                
                if (moods.length === 0) {
                    container.innerHTML = '<div class="text-gray-500 text-xs">No mood entries yet</div>';
                    return;
                }
                
                container.innerHTML = moods.map(m => {
                    const date = new Date(m.timestamp);
                    const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    const timeStr = date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                    
                    return `
                        <div class="bg-[#0a0a0a] border border-[#2a2a2a] rounded p-2 flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl">${m.mood}</span>
                                <div class="text-xs">
                                    <div class="text-gray-400">${dateStr} ${timeStr}</div>
                                    <div class="text-gray-500">P:${m.physical} M:${m.mental}</div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            async renderTasks() {
                const allTasks = await this.db.getAll('tasks');
                const tasks = allTasks.filter(t => (t.category || 'personal') === this.currentCategory);
                const container = document.getElementById('tasks');
                
                if (tasks.length === 0) {
                    container.innerHTML = '<div class="text-gray-500 text-sm">No tasks yet</div>';
                    return;
                }
                
                container.innerHTML = tasks.map(task => `
                    <div class="flex items-center gap-3 group">
                        <input type="checkbox" ${task.completed ? 'checked' : ''} 
                               onchange="app.toggleTask(${task.id})"
                               class="w-4 h-4 accent-primary cursor-pointer">
                        <span class="text-gray-300 flex-1 ${task.completed ? 'line-through opacity-50' : ''}">${task.text}</span>
                        <button onclick="app.deleteTask(${task.id})" 
                                class="text-red-500 opacity-0 group-hover:opacity-100 text-sm">√ó</button>
                    </div>
                `).join('');
            }

            async toggleTask(id) {
                const tasks = await this.db.getAll('tasks');
                const task = tasks.find(t => t.id === id);
                if (task) {
                    task.completed = !task.completed;
                    await this.db.update('tasks', task);
                    await this.renderTasks();
                }
            }

            async deleteTask(id) {
                await this.db.delete('tasks', id);
                await this.renderTasks();
            }

            addTask() {
                const modal = document.getElementById('modal');
                const title = document.getElementById('modalTitle');
                const content = document.getElementById('modalContent');
                const submit = document.getElementById('modalSubmit');
                
                title.textContent = 'Add Task';
                content.innerHTML = '<input id="taskInput" type="text" placeholder="Task description" class="w-full bg-[#0a0a0a] border border-[#2a2a2a] rounded px-3 py-2 text-white">';
                
                modal.classList.remove('hidden');
                setTimeout(() => document.getElementById('taskInput').focus(), 100);
                
                submit.onclick = async () => {
                    const input = document.getElementById('taskInput').value.trim();
                    if (input) {
                        await this.db.add('tasks', { 
                            text: input, 
                            completed: false,
                            category: this.currentCategory
                        });
                        await this.renderTasks();
                        this.closeModal();
                    }
                };
            }

            async renderNotes() {
                const allNotes = await this.db.getAll('notes');
                const notes = allNotes.filter(n => (n.category || 'personal') === this.currentCategory);
                const container = document.getElementById('notes');
                
                if (notes.length === 0) {
                    container.innerHTML = '<div class="text-gray-500 text-sm">No notes yet</div>';
                    return;
                }
                
                container.innerHTML = notes.map(note => `
                    <div class="bg-[#0a0a0a] border border-[#2a2a2a] rounded p-3 group relative">
                        <button onclick="app.deleteNote(${note.id})" 
                                class="absolute top-2 right-2 text-red-500 opacity-0 group-hover:opacity-100 text-sm">√ó</button>
                        <div class="font-medium text-sm mb-1">${note.title}</div>
                        <div class="text-gray-400 text-xs">${note.content.substring(0, 100)}${note.content.length > 100 ? '...' : ''}</div>
                    </div>
                `).join('');
            }

            async deleteNote(id) {
                await this.db.delete('notes', id);
                await this.renderNotes();
            }
            
            addNote() {
                const modal = document.getElementById('modal');
                const title = document.getElementById('modalTitle');
                const content = document.getElementById('modalContent');
                const submit = document.getElementById('modalSubmit');
                
                title.textContent = 'Add Note';
                content.innerHTML = `
                    <input id="noteTitle" type="text" placeholder="Note title" class="w-full bg-[#0a0a0a] border border-[#2a2a2a] rounded px-3 py-2 text-white mb-3">
                    <textarea id="noteContent" placeholder="Note content" rows="4" class="w-full bg-[#0a0a0a] border border-[#2a2a2a] rounded px-3 py-2 text-white"></textarea>
                `;
                
                modal.classList.remove('hidden');
                setTimeout(() => document.getElementById('noteTitle').focus(), 100);
                
                submit.onclick = async () => {
                    const noteTitle = document.getElementById('noteTitle').value.trim();
                    const noteContent = document.getElementById('noteContent').value.trim();
                    if (noteTitle && noteContent) {
                        await this.db.add('notes', { 
                            title: noteTitle, 
                            content: noteContent,
                            category: this.currentCategory
                        });
                        await this.renderNotes();
                        this.closeModal();
                    }
                };
            }

            closeModal() {
                document.getElementById('modal').classList.add('hidden');
            }
        }

        // Initialize app
        const app = new App();
    </script>
    
</body>
</html>